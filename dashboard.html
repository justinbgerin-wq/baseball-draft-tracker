<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Draft Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.4;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        header h1 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .sync-info {
            background: #e3f2fd;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .sync-info strong {
            color: #ffd700;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 300px;
        }

        .dashboard-card h3 {
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            margin-bottom: 15px;
        }

        .user-info h4 {
            color: #2c3e50;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #ffffff;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #3498db;
            display: block;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: 500;
        }

        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 120px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .last-sync {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }

        .recent-activity {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recent-activity h3 {
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .activity-item {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .activity-text {
            color: #333;
        }

        .collaboration-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .collaboration-note p {
            margin: 0;
            color: #856404;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öæ Baseball Draft Dashboard</h1>
            <div class="sync-info">
                <strong>Live Collaboration Mode</strong> - All changes sync automatically between users
            </div>
        </header>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>üë§ Current User</h3>
                <div class="user-info">
                    <h4 id="currentUser">Loading...</h4>
                    <div id="userStats" class="stats">
                        <div class="stat-item">
                            <span class="stat-number" id="userPlayerCount">0</span>
                            <span class="stat-label">Players</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="userDraftCount">0</span>
                            <span class="stat-label">Drafted</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="userActionCount">0</span>
                            <span class="stat-label">Actions</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>üìä Draft Overview</h3>
                <div class="stats" id="overviewStats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalPlayers">0</span>
                        <span class="stat-label">Total Players</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalDrafted">0</span>
                        <span class="stat-label">Total Drafted</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalTeams">0</span>
                        <span class="stat-label">Teams</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="lastUpdate">--</span>
                        <span class="stat-label">Last Update</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="recent-activity">
            <h3>üïê Recent Activity</h3>
            <div id="activityLog">
                <div class="activity-item">
                    <div class="activity-time">Loading...</div>
                    <div class="activity-text">Initializing dashboard...</div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-primary" onclick="openMainTracker()">üìã Open Draft Tracker</button>
            <button class="btn btn-secondary" onclick="exportData()">üíæ Export Data</button>
            <button class="btn btn-secondary" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        </div>

        <div class="last-sync">
            <span id="lastSyncTime">Last sync: Never</span>
        </div>

        <div class="collaboration-note">
            <p>üí° <strong>Pro Tip:</strong> This dashboard shows live data from your main draft tracker. Any changes made by either user will appear here automatically. Keep both tabs open for real-time collaboration!</p>
        </div>
    </div>

    <script>
        // Shared storage key - both users must use the same key
        const STORAGE_KEY = 'baseballDraftTracker';
        let currentUserId = '';
        
        // Initialize user identity
        function initializeUser() {
            const savedUser = localStorage.getItem('dashboardUserId');
            if (savedUser) {
                currentUserId = savedUser;
            } else {
                // Generate a simple user ID based on timestamp
                currentUserId = 'User_' + Date.now();
                localStorage.setItem('dashboardUserId', currentUserId);
            }
            
            document.getElementById('currentUser').textContent = currentUserId;
        }

        // Load and display data
        function loadData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    updateDashboard(data);
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
        }

        // Update dashboard display
        function updateDashboard(data) {
            const players = data.players || [];
            const drafted = players.filter(p => p.drafted);
            const teams = new Set(drafted.map(p => p.fantasyOwner)).size;
            
            // Update overview stats
            document.getElementById('totalPlayers').textContent = players.length;
            document.getElementById('totalDrafted').textContent = drafted.length;
            document.getElementById('totalTeams').textContent = teams;
            
            // Update user stats
            document.getElementById('userPlayerCount').textContent = players.length;
            document.getElementById('userDraftCount').textContent = drafted.length;
            document.getElementById('userActionCount').textContent = localStorage.getItem('actionCount') || '0';
            
            // Update last sync time
            if (data.lastUpdated) {
                const updateTime = new Date(data.lastUpdated).toLocaleString();
                document.getElementById('lastUpdate').textContent = updateTime;
                document.getElementById('lastSyncTime').textContent = 'Last sync: ' + updateTime;
            }
            
            // Update activity log
            updateActivityLog(players.slice(-5).reverse());
        }

        // Update activity log
        function updateActivityLog(recentPlayers) {
            const activityLog = document.getElementById('activityLog');
            activityLog.innerHTML = '';
            
            if (recentPlayers.length === 0) {
                activityLog.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-time">No activity yet</div>
                        <div class="activity-text">Start by adding players to the draft tracker</div>
                    </div>
                `;
                return;
            }
            
            recentPlayers.forEach(player => {
                const actionText = player.drafted ? 
                    `Drafted ${player.name} to ${player.fantasyOwner}` : 
                    `Added ${player.name}`;
                    
                const timeAgo = getTimeAgo(player.addedDate || player.lastUpdated);
                
                activityLog.innerHTML += `
                    <div class="activity-item">
                        <div class="activity-time">${timeAgo}</div>
                        <div class="activity-text">${actionText}</div>
                    </div>
                `;
            });
        }

        // Get time ago string
        function getTimeAgo(dateString) {
            if (!dateString) return 'Unknown time';
            
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${diffDays}d ago`;
        }

        // Action functions
        function openMainTracker() {
            // Increment action count
            const currentCount = parseInt(localStorage.getItem('actionCount') || '0');
            localStorage.setItem('actionCount', currentCount + 1);
            
            // Open main tracker
            window.open('index.html', '_blank');
        }

        function exportData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                const data = JSON.parse(stored);
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `baseball-draft-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This will clear data for BOTH users and cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem('actionCount');
                location.reload();
            }
        }

        // Listen for storage changes (from other tab/user)
        window.addEventListener('storage', function(e) {
            if (e.key === STORAGE_KEY) {
                loadData();
            }
        });

        // Initialize
        initializeUser();
        loadData();

        // Auto-refresh every 30 seconds for live updates
        setInterval(loadData, 30000);
    </script>
</body>
</html>
